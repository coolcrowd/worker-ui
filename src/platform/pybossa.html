<div id="ractive-container"></div>
<script src="https://worker.pse.kelunik.com/ui/bundle.js"></script>
<script>
    pybossa.taskLoaded(function (task, deferred) {
        if (!$.isEmptyObject(task)) {
            CreativeCrowd.init(properties = {
                workerServiceURL: "https://worker.pse.kelunik.com/",
                // those params will be passed to the crowdplatform implementaion in the object service
                osParams: {
                    workerId: 121,
                    assignmentId: 1234
                },
                platform: task.info.platformName,
                experiment: task.info.expID,
                preview: false,
                test: false
            });

            CreativeCrowd.onFinished(function (viewData, submittedData) {
                pybossa.saveTask(task.id, answer).done(function () {
                    deferred.resolve();
                });
            });

            CreativeCrowd.beforeIdentifyWorker(function () {
                var code = generateCode();
                pybossa.saveTask(task.info.idTask[0], code).done(function () {

                });
            });

        }
        deferred.resolve(task);
    });

    pybossa.presentTask(function (task, deferred) {
        if (!$.isEmptyObject(task)) {
            CreativeCrowd.load();
        }
        else {
//            $(".skeleton").hide();
//            $("#loading").hide();
//            $("#finish").fadeIn(500);
        }
    });

    // this generates a random code with 10 characters in [a-zA-Z0-9]
    function generateCode() {
        var s = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        return Array.apply(null, new Array(10)).map(function () {
            return s.charAt(Math.floor(Math.random() * s.length));
        }).join('');
    }

    pybossa.run('ccw');
</script>